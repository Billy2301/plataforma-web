@using Entity.ClinicaModels
@model HomeViewModel
@{
    ViewData["Title"] = "Home Page";
}
<!-- Card Wellcome -->
<div class="toast toast-onload align-items-center text-bg-warning border-0" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="toast-body hstack align-items-start gap-6">
        <i class="ti ti-alert-circle fs-6"></i>
        <div>
            <h5 class="text-white fs-3 mb-1">Bienvenido a Portal de usuarios</h5>
            <h6 class="text-white fs-2 mb-0"><small>Plataforma para gestión de citas y pagos.</small></h6>
        </div>
        <button type="button" class="btn-close btn-close-white fs-2 m-0 ms-auto shadow-none" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
</div>
<div class="row">
    <div class="col-md-6 d-flex align-items-stretch">
        <a asp-controller="ReservarCita" asp-area="" asp-action="InicioDeReserva" class="card bg-primary-subtle text-white w-100 card-hover">
            <div class="card-body">
                <div class="d-flex align-items-center text-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="5em" height="5em" viewBox="0 0 24 24">
                        <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
                            <!-- Contorno del icono -->
                            <path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2" stroke-dasharray="120" stroke-dashoffset="120">
                                <animate fill="freeze" attributeName="stroke-dashoffset" begin="0.5s" dur="1s" values="120;0"></animate>
                            </path>
                            <!-- Parte superior interna -->
                            <path d="M9 5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v0a2 2 0 0 1-2 2h-2a2 2 0 0 1-2-2" stroke-dasharray="50" stroke-dashoffset="50">
                                <animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.7s" values="50;0"></animate>
                            </path>
                            <!-- Línea vertical -->
                            <path d="M10 11h2a2 2 0 0 1 0 6h-2v-6m0 0v4" stroke-dasharray="40" stroke-dashoffset="40">
                                <animate fill="freeze" attributeName="stroke-dashoffset" begin="0.8s" dur="0.7s" values="40;0"></animate>
                            </path>
                            <!-- Base del icono -->

                        </g>
                    </svg>


                    <div class="ms-4">
                        <h6 class="card-title mb-1 text-primary">
                            Reserve su cita para
                        </h6>
                        <h4 class="card-text fw-normal text-primary">
                            <b>Diagnóstico</b>
                        </h4>
                    </div>
                    <div class="ms-auto">
                        <i class="ti ti-arrow-right fs-8"></i>
                    </div>
                </div>
            </div>
        </a>
    </div>

    <div class="col-md-6 d-flex align-items-stretch">
        <a asp-controller="ReservarTratamiento" asp-area="" asp-action="InicioDeReserva" class="card bg-primary-subtle text-white w-100 card-hover">
            <div class="card-body">
                <div class="d-flex align-items-center text-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="5em" height="5em" viewBox="0 0 24 24">
                        <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
                            <path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"
                            stroke-dasharray="120" stroke-dashoffset="120">
                                <animate fill="freeze" attributeName="stroke-dashoffset" begin="0.5s" dur="1s" values="120;0" />
                            </path>
                            <path d="M9 5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v0a2 2 0 0 1-2 2h-2a2 2 0 0 1-2-2"
                            stroke-dasharray="50" stroke-dashoffset="50">
                                <animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.7s" values="50;0" />
                            </path>
                            <path d="M9 12v-1h6v1"
                            stroke-dasharray="30" stroke-dashoffset="30">
                                <animate fill="freeze" attributeName="stroke-dashoffset" begin="0.7s" dur="0.5s" values="30;0" />
                            </path>
                            <path d="M12 11v6"
                            stroke-dasharray="20" stroke-dashoffset="20">
                                <animate fill="freeze" attributeName="stroke-dashoffset" begin="0.8s" dur="0.5s" values="20;0" />
                            </path>
                            <path d="M11 17h2"
                            stroke-dasharray="10" stroke-dashoffset="10">
                                <animate fill="freeze" attributeName="stroke-dashoffset" begin="0.9s" dur="0.3s" values="10;0" />
                            </path>
                        </g>
                    </svg>


                    <div class="ms-4">
                        <h6 class="card-title mb-1 text-primary">
                            Reserve su cita para
                        </h6>
                        <h4 class="card-text fw-normal text-primary">
                            <b>Tratamiento</b>
                        </h4>
                    </div>
                    <div class="ms-auto">
                        <i class="ti ti-arrow-right fs-8"></i>
                    </div>
                </div>
            </div>
        </a>
    </div>

    @if (Model.ListPacientes != null && Model.ListPacientes.Count > 0)
    {

        <div class="col-md-6 d-flex align-items-stretch">
            <a asp-controller="HistoriaClinica" asp-area="" asp-action="Historias" class="card bg-primary-subtle text-white w-100 card-hover">
                <div class="card-body">
                    <div class="d-flex align-items-center text-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" width="5em" height="5em" viewBox="0 0 24 24">
                            <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" color="currentColor">
                                <path d="M22 11.5V6.114c0-.791 0-1.186-.194-1.594a2.4 2.4 0 0 0-.565-.71c-.354-.28-.65-.347-1.241-.483c-.92-.21-1.934-.327-3-.327c-1.917 0-3.668.378-5 1S8.917 5 7 5c-1.066 0-2.08-.117-3-.327c-.96-.22-2 .456-2 1.441v10.772c0 .791 0 1.187.194 1.594c.11.233.363.55.565.71c.354.28.65.347 1.241.483c.92.21 1.934.327 3 .327c1.469 0 2.84-.222 4-.605M14 19s1 0 2 2c0 0 3.177-5 6-6" stroke-dasharray="120" stroke-dashoffset="120">
                                    <animate fill="freeze" attributeName="stroke-dashoffset" begin="0.5s" dur="1s" values="120;0"></animate>
                                </path>
                                <path d="M14.5 11.5a2.5 2.5 0 1 1-5 0a2.5 2.5 0 0 1 5 0m-9 1v.009m13-2.017v.01" stroke-dasharray="35" stroke-dashoffset="35">
                                    <animate fill="freeze" attributeName="stroke-dashoffset" begin="0.5s" dur="0.7s" values="35;0"></animate>
                                </path>
                            </g>
                        </svg>
                        <div class="ms-4">
                            <h4 class="card-title mb-1 text-primary"><b>Pagos pendientes</b></h4>
                            <h6 class="card-text fw-normal text-primary d-none d-md-inline">
                                Clic aquí para revisar pagos pendientes de <b>evaluaciones</b> y/o <b>tratamientos</b>.
                            </h6>
                        </div>
                        <div class="ms-auto">
                            <i class="ti ti-arrow-right fs-8"></i>
                        </div>
                    </div>
                </div>
            </a>
        </div>

        <div class="col-md-6 d-flex align-items-stretch">
            <a asp-controller="HistorialCita" asp-area="" asp-action="Informe" class="card bg-primary-subtle text-white w-100 card-hover">
                <div class="card-body">
                    <div class="d-flex align-items-center text-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" width="5em" height="5em" viewBox="0 0 48 48">
                            <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="4">
                                <path d="M42 24V9a3 3 0 0 0-3-3H9a3 3 0 0 0-3 3v30a3 3 0 0 0 3 3h15" stroke-dasharray="100" stroke-dashoffset="100">
                                    <animate fill="freeze" attributeName="stroke-dashoffset" begin="0.5s" dur="0.5s" values="100;0"></animate>
                                </path>
                                <circle cx="32" cy="32" r="6" stroke-dasharray="37.7" stroke-dashoffset="37.7">
                                    <animate fill="freeze" attributeName="stroke-dashoffset" begin="0.5s" dur="0.5s" values="37.7;0"></animate>
                                </circle>
                                <path d="m37 36l5 4M14 16h20m-20 8h8" stroke-dasharray="64" stroke-dashoffset="64">
                                    <animate fill="freeze" attributeName="stroke-dashoffset" begin="0.5s" dur="0.5s" values="64;0"></animate>
                                </path>
                            </g>
                        </svg>
                        <div class="ms-4">
                            <h4 class="card-title mb-1 text-primary"><b>Historial de citas</b></h4>
                            <h6 class="card-text fw-normal text-primary d-none d-md-inline">
                                Clic aquí para revisar el historial de <b>evaluaciones</b> y/o <b>tratamientos</b> realizadas.
                            </h6>
                        </div>
                        <div class="ms-auto">
                            <i class="ti ti-arrow-right fs-8"></i>
                        </div>
                    </div>
                </div>
            </a>
        </div>
    }

</div>

<!-- reservas Diagnostico -->
<div class="card" id="cardPagos" style="display:none;">
    <div class="card-body">
        <h5 class="card-title fw-semibold text-primary">DIAGNÓSTICO: Reserva de citas en curso</h5>
        <p class="card-subtitle mb-3 d-none" style="text-align:justify">
            Clic aquí para realizar los pagos necesarios para proceder con tu atención.
        </p>
        <div class="align-items-stretch">
            @if (Model.ListReservaDx != null && Model.ListReservaDx.Count > 0)
            {
                @foreach (var pago in Model.ListReservaDx)
                {
                    if (pago.EstadoPago == "PENDIENTE")
                    {
                        try
                        {
                            <script>
                                document.getElementById('cardPagos').style.display = 'block';
                            </script>
                            <div class="card bg-light-subtle text-white w-100 border-1 border-muted">
                                <div class="card-body p-3 w-100">
                                    <div class="d-flex">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="2.5em" height="2.5em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-dark icon icon-tabler icons-tabler-outline icon-tabler-square-rounded-letter-d"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><path d="M10 8v8h2a2 2 0 0 0 2 -2v-4a2 2 0 0 0 -2 -2h-2z" /><path d="M12 3c7.2 0 9 1.8 9 9s-1.8 9 -9 9s-9 -1.8 -9 -9s1.8 -9 9 -9z" /></svg>
                                        <div class="text-start ms-2">
                                            <h4 class="card-title mb-1 text-dark">
                                                @pago.NombreCompleto
                                            </h4>
                                            <h6 class="card-text fw-normal mb-1 mb-md-0 text-dark">
                                                Estado de solicitud:  <b>PENDIENTE DE PAGO </b>  - Fecha de creación: @pago.FechaTriajeOnline.ToString("dd MMM yyyy")<br />
                                            </h6>
                                        </div>
                                    </div>

                                    <div class="mt-3 d-md-flex gap-3 ">
                                        <a asp-action="FormularioDeReserva" asp-controller="ReservarCita" asp-route-triajeId="@pago.TriajeOnlineId" asp-route-pagoId="@pago.PagoCitaId" asp-route-doAction="Revisar" class="my-1 d-flex align-items-center btn border-1  bg-primary text-white card-hover">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M7 7H6a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2v-1" /><path d="M20.385 6.585a2.1 2.1 0 0 0-2.97-2.97L9 12v3h3zM16 5l3 3" /></g></svg>
                                            <div class="w-100 text-center">
                                                <div class="card-text fs-5 fw-normal">
                                                    Revisar solicitud
                                                </div>
                                            </div>
                                        </a>
                                        @if(pago.PagoCitaId != null){
                                            <form asp-action="Index" asp-controller="Home" method="post" onsubmit="return subminLoagin(this)" class="my-1">
                                                <input type="hidden" name="id" value="@pago.PagoCitaId" />
                                                <button type="submit" class="w-100 d-flex align-items-center btn border-1 bg-warning text-white card-hover">
                                                    <svg width="2em" height="2em" viewBox="0 0 15.69 15.69" xmlns="http://www.w3.org/2000/svg">
                                                        <g stroke="currentColor" fill="none" stroke-linecap="round" stroke-miterlimit="22.9256">
                                                            <path stroke-width="1.12" stroke-linejoin="round" d="M12.61 5.32a.28.28 0 1 0 0-.56M3.08 5.32a.28.28 0 1 0 0-.56" />
                                                            <line stroke-width="1.12" stroke-linejoin="round" x1="5.04" y1="11.77" x2="5.04" y2="14.01" />
                                                            <line stroke-width="1.12" stroke-linejoin="round" x1="10.65" y1="11.77" x2="10.65" y2="14.01" />
                                                            <line stroke-width="1.12" stroke-linejoin="round" x1="7.85" y1="12.89" x2="7.85" y2="15.13" />
                                                            <path stroke-width="1.12" stroke-linejoin="round" d="M14.01 0.56H1.68c-.62 0-1.12.5-1.12 1.12v6.73c0 .62.5 1.12 1.12 1.12h12.33c.62 0 1.12-.5 1.12-1.12V1.68c0-.62-.5-1.12-1.12-1.12" />
                                                            <path stroke-width="1.44" d="M5.34 4.83c0-2.61 3.36-2.61 3.36 0M7.04 4.5c0 2.61 3.36 2.61 3.36 0" />
                                                        </g>
                                                    </svg>
                                                    <div class="w-100 text-center ms-2">
                                                        <div class="card-text fs-5 fw-normal">
                                                            Para pagar,
                                                            <b class="fs-4 fw-semibold">clic aquí ..</b>
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="1.5em" height="1.5em" viewBox="0 0 32.1 43.15" class="d-none d-md-inline">
                                                                <g stroke-miterlimit="22.9256" fill="none">
                                                                    <circle cx="16.05" cy="16.05" r="15.16" stroke="gray" stroke-width="1.78" transform-origin="center">
                                                                        <animateTransform attributeName="transform" type="scale" from="0.1" to="1" dur="0.5s" repeatCount="indefinite" />
                                                                    </circle>
                                                                    <circle cx="16.05" cy="16.05" r="5.52" stroke="gray" stroke-width="1.78" transform-origin="center">
                                                                        <animateTransform attributeName="transform" type="scale" from="0.1" to="1" dur="0.5s" repeatCount="indefinite" />
                                                                    </circle>
                                                                    <path fill="white" stroke="black" stroke-width="1.78" stroke-linecap="round" stroke-linejoin="round" d="M13.89 33.77c-0.05,-6.16 -0.1,-12.32 -0.16,-18.48 0,-2.35 4.5,-2.37 4.66,0 0,3.81 0,7.61 0,11.41 0,-5.43 4.09,-5.21 3.91,0 0.24,-4.88 4.81,-4.44 4.44,1.28 -0.04,-3.46 3.77,-4.21 4.19,-1.05 0,3.56 0,7.13 0,10.69 -0.63,2.61 -2.29,4.03 -4.64,4.64 -3.17,0 -6.34,0 -9.51,0 -1.47,0.13 -6.49,-5.88 -10.94,-10.94 -2.09,-2.25 0.6,-4.4 2.7,-2.69 1.78,1.71 3.57,3.42 5.35,5.14z" />
                                                                </g>
                                                            </svg>
                                                        </div>
                                                    </div>
                                                </button>
                                            </form>

                                        }
                                    </div>

                                </div>
                            </div>
                        }
                        catch (Exception ex)
                        {
                            <p><small class="text-muted">@ex.Message</small></p>
                            <script>
                                document.getElementById('cardPagos').style.display = 'block';
                            </script>
                        }

                    }
                    else if (pago.EstadoPago == "PAGADO" && pago.FechaPago.HasValue && pago.FechaPago >= DateTime.Now.AddDays(-1))
                    {
                        try
                        {
                            <script>
                                document.getElementById('cardPagos').style.display = 'block';
                            </script>
                            <div class="card bg-light-subtle text-white w-100 border-1 border-muted">
                                <div class="card-body p-3 w-100">
                                    <div class="d-flex">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="2.5em" height="2.5em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-dark icon icon-tabler icons-tabler-outline icon-tabler-square-rounded-letter-d"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M10 8v8h2a2 2 0 0 0 2 -2v-4a2 2 0 0 0 -2 -2h-2z"></path><path d="M12 3c7.2 0 9 1.8 9 9s-1.8 9 -9 9s-9 -1.8 -9 -9s1.8 -9 9 -9z"></path></svg>
                                        <div class="text-start ms-2">
                                            <h4 class="card-title mb-1 text-dark">
                                                @pago.NombreCompleto
                                            </h4>
                                            <h6 class="card-text fw-normal mb-1 mb-md-0 text-dark">
                                                Estado de solicitud: <b>@pago.EstadoPago </b>  - Fecha de Pago: @pago.FechaPago?.ToString("dd MMM yyyy")
                                            </h6>
                                        </div>
                                    </div>

                                    <div class="mt-3 d-md-flex gap-3 ">
                                        <a class="d-flex align-items-center btn border-1 bg-info text-white card-hover" onclick="ShowDetallePago(@pago.PagoTriajeId)" data-bs-html="true" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-original-title="<i class='ti ti-brand-telegram fs-5 text-info me-3'></i><b class='text-info'>PAGO REALIZADO</b><hr class='m-1'>Estamos procesando su pago. Una asesora se contactará con usted a la brevedad.">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3" /><path d="M20.188 10.934c.388.472.582.707.582 1.066s-.194.594-.582 1.066C18.768 14.79 15.636 18 12 18s-6.768-3.21-8.188-4.934c-.388-.472-.582-.707-.582-1.066s.194-.594.582-1.066C5.232 9.21 8.364 6 12 6s6.768 3.21 8.188 4.934Z" /></g></svg>
                                            <div class="w-100 text-center">
                                                <div class="card-text fs-5 fw-normal">
                                                    Revisar pago
                                                </div>
                                            </div>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        }
                        catch (Exception ex)
                        {
                            <p><small class="text-muted">@ex.Message</small></p>
                            <script>
                                document.getElementById('cardPagos').style.display = 'none';
                            </script>
                        }

                    }
                }
            }

        </div>
    </div>
</div>

<!-- Eliminar luego -->
<div class="card" id="cardPagos2" style="display:none;">
    <div class="card-body">
        <h5 class="card-title fw-semibold text-primary">DIAGNÓSTICO: Reserva de citas en curso</h5>
        <p class="card-subtitle mb-3 d-none" style="text-align:justify">
            Clic aquí para realizar los pagos necesarios para proceder con tu atención.
        </p>
        <div class="align-items-stretch">
            <!--  pagos apertura -->
            @if (Model.ListPagoTriaje != null && Model.ListPagoTriaje.Count > 0)
            {
                @foreach (var pago in Model.ListPagoTriaje)
                {
                    @* if (pago.EstadoPago == "PENDIENTE")
                    {
                        try
                        {
                            <script>
                                document.getElementById('cardPagos').style.display = 'block';
                            </script>
                            <div class="card bg-light-subtle text-white w-100 border-1 border-muted">
                                <div class="card-body p-3 w-100">
                                    <div class="d-flex">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="2.5em" height="2.5em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-dark icon icon-tabler icons-tabler-outline icon-tabler-square-rounded-letter-d"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><path d="M10 8v8h2a2 2 0 0 0 2 -2v-4a2 2 0 0 0 -2 -2h-2z" /><path d="M12 3c7.2 0 9 1.8 9 9s-1.8 9 -9 9s-9 -1.8 -9 -9s1.8 -9 9 -9z" /></svg>
                                        <div class="text-start ms-2">
                                            <h4 class="card-title mb-1 text-dark">
                                                @pago.NombreCompleto
                                            </h4>
                                            <h6 class="card-text fw-normal mb-1 mb-md-0 text-dark">
                                                Estado de solicitud:  <b>PENDIENTE DE PAGO </b>  - Fecha de creación: @pago.FechaTriajeOnline.ToString("dd MMM yyyy")<br />
                                            </h6>
                                        </div>
                                    </div>

                                    <div class="mt-3 d-md-flex gap-3 ">
                                        <a asp-action="FormularioDeReserva" asp-controller="ReservarCita" asp-route-triajeId="@pago.TriajeOnlineId" asp-route-pagoId="@pago.PagoCitaId" asp-route-doAction="Revisar" class="my-1 d-flex align-items-center btn border-1  bg-primary text-white card-hover">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M7 7H6a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2v-1" /><path d="M20.385 6.585a2.1 2.1 0 0 0-2.97-2.97L9 12v3h3zM16 5l3 3" /></g></svg>
                                            <div class="w-100 text-center">
                                                <div class="card-text fs-5 fw-normal">
                                                    Revisar solicitud
                                                </div>
                                            </div>
                                        </a>
                                        <form asp-action="Index" asp-controller="Home" method="post" onsubmit="return subminLoagin(this)" class="my-1">
                                            <input type="hidden" name="id" value="@pago.PagoCitaId" />
                                            <button type="submit" class="w-100 d-flex align-items-center btn border-1 bg-warning text-white card-hover">
                                                <svg width="2em" height="2em" viewBox="0 0 15.69 15.69" xmlns="http://www.w3.org/2000/svg">
                                                    <g stroke="currentColor" fill="none" stroke-linecap="round" stroke-miterlimit="22.9256">
                                                        <path stroke-width="1.12" stroke-linejoin="round" d="M12.61 5.32a.28.28 0 1 0 0-.56M3.08 5.32a.28.28 0 1 0 0-.56" />
                                                        <line stroke-width="1.12" stroke-linejoin="round" x1="5.04" y1="11.77" x2="5.04" y2="14.01" />
                                                        <line stroke-width="1.12" stroke-linejoin="round" x1="10.65" y1="11.77" x2="10.65" y2="14.01" />
                                                        <line stroke-width="1.12" stroke-linejoin="round" x1="7.85" y1="12.89" x2="7.85" y2="15.13" />
                                                        <path stroke-width="1.12" stroke-linejoin="round" d="M14.01 0.56H1.68c-.62 0-1.12.5-1.12 1.12v6.73c0 .62.5 1.12 1.12 1.12h12.33c.62 0 1.12-.5 1.12-1.12V1.68c0-.62-.5-1.12-1.12-1.12" />
                                                        <path stroke-width="1.44" d="M5.34 4.83c0-2.61 3.36-2.61 3.36 0M7.04 4.5c0 2.61 3.36 2.61 3.36 0" />
                                                    </g>
                                                </svg>
                                                <div class="w-100 text-center ms-2">
                                                    <div class="card-text fs-5 fw-normal">
                                                        Para pagar,
                                                        <b class="fs-4 fw-semibold">clic aquí ..</b>
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="1.5em" height="1.5em" viewBox="0 0 32.1 43.15" class="d-none d-md-inline">
                                                            <g stroke-miterlimit="22.9256" fill="none">
                                                                <circle cx="16.05" cy="16.05" r="15.16" stroke="gray" stroke-width="1.78" transform-origin="center">
                                                                    <animateTransform attributeName="transform" type="scale" from="0.1" to="1" dur="0.5s" repeatCount="indefinite" />
                                                                </circle>
                                                                <circle cx="16.05" cy="16.05" r="5.52" stroke="gray" stroke-width="1.78" transform-origin="center">
                                                                    <animateTransform attributeName="transform" type="scale" from="0.1" to="1" dur="0.5s" repeatCount="indefinite" />
                                                                </circle>
                                                                <path fill="white" stroke="black" stroke-width="1.78" stroke-linecap="round" stroke-linejoin="round" d="M13.89 33.77c-0.05,-6.16 -0.1,-12.32 -0.16,-18.48 0,-2.35 4.5,-2.37 4.66,0 0,3.81 0,7.61 0,11.41 0,-5.43 4.09,-5.21 3.91,0 0.24,-4.88 4.81,-4.44 4.44,1.28 -0.04,-3.46 3.77,-4.21 4.19,-1.05 0,3.56 0,7.13 0,10.69 -0.63,2.61 -2.29,4.03 -4.64,4.64 -3.17,0 -6.34,0 -9.51,0 -1.47,0.13 -6.49,-5.88 -10.94,-10.94 -2.09,-2.25 0.6,-4.4 2.7,-2.69 1.78,1.71 3.57,3.42 5.35,5.14z" />
                                                            </g>
                                                        </svg>
                                                    </div>
                                                </div>
                                            </button>
                                        </form>
                                    </div>

                                </div>
                            </div>
                        }
                        catch (Exception ex)
                        {
                            <p><small class="text-muted">@ex.Message</small></p>
                            <script>
                                document.getElementById('cardPagos').style.display = 'block';
                            </script>
                        }

                    } *@
                    if (pago.EstadoPago == "PAGADO" && pago.FechaPago.HasValue && pago.FechaPago >= DateTime.Now.AddDays(-1))
                    {
                        try
                        {
                            <script>
                                document.getElementById('cardPagos2').style.display = 'block';
                            </script>
                            <div class="card bg-light-subtle text-white w-100 border-1 border-muted">
                                <div class="card-body p-3 w-100">
                                    <div class="d-flex">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="2.5em" height="2.5em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-dark icon icon-tabler icons-tabler-outline icon-tabler-square-rounded-letter-d"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M10 8v8h2a2 2 0 0 0 2 -2v-4a2 2 0 0 0 -2 -2h-2z"></path><path d="M12 3c7.2 0 9 1.8 9 9s-1.8 9 -9 9s-9 -1.8 -9 -9s1.8 -9 9 -9z"></path></svg>
                                        <div class="text-start ms-2">
                                            <h4 class="card-title mb-1 text-dark">
                                                @pago.NombreCompleto
                                            </h4>
                                            <h6 class="card-text fw-normal mb-1 mb-md-0 text-dark">
                                                Estado de solicitud: <b>@pago.EstadoPago </b>  - Fecha de Pago: @pago.FechaPago?.ToString("dd MMM yyyy")
                                            </h6>
                                        </div>
                                    </div>

                                    <div class="mt-3 d-md-flex gap-3 ">
                                        <a class="d-flex align-items-center btn border-1 bg-info text-white card-hover" onclick="ShowDetallePago(@pago.PagoTriajeId)" data-bs-html="true" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-original-title="<i class='ti ti-brand-telegram fs-5 text-info me-3'></i><b class='text-info'>PAGO REALIZADO</b><hr class='m-1'>Estamos procesando su pago. Una asesora se contactará con usted a la brevedad.">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3" /><path d="M20.188 10.934c.388.472.582.707.582 1.066s-.194.594-.582 1.066C18.768 14.79 15.636 18 12 18s-6.768-3.21-8.188-4.934c-.388-.472-.582-.707-.582-1.066s.194-.594.582-1.066C5.232 9.21 8.364 6 12 6s6.768 3.21 8.188 4.934Z" /></g></svg>
                                            <div class="w-100 text-center">
                                                <div class="card-text fs-5 fw-normal">
                                                    Revisar pago
                                                </div>
                                            </div>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        }
                        catch (Exception ex)
                        {
                            <p><small class="text-muted">@ex.Message</small></p>
                            <script>
                                document.getElementById('cardPagos2').style.display = 'none';
                            </script>
                        }

                    }
                }
            }

            <!--  triajes enviados con orientación -->
            @if (Model.ListTriajeOnline != null && Model.ListTriajeOnline.Count > 0)
            {
                <script>
                    document.getElementById('cardPagos').style.display = 'block';
                </script>
                @foreach (var triaje in Model.ListTriajeOnline)
                {
                    <div class="card bg-light-subtle text-white w-100 border-1 border-muted" data-bs-html="true" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-original-title="<i class='ti ti-brand-telegram fs-5 text-primary me-3'></i><b class='text-primary'>SOLICITUD ENVIADA</b><hr  class='m-1'>Recibimos su solicitud, una asesora se comunicará con usted a la brevedad">
                        <div class="card-body p-3 w-100">
                            <div class="d-flex">
                                <svg xmlns="http://www.w3.org/2000/svg" width="2.5em" height="2.5em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-dark icon icon-tabler icons-tabler-outline icon-tabler-square-rounded-letter-d"><path stroke="none" d="M0 0h24v24H0z" fill="none" /><path d="M10 8v8h2a2 2 0 0 0 2 -2v-4a2 2 0 0 0 -2 -2h-2z" /><path d="M12 3c7.2 0 9 1.8 9 9s-1.8 9 -9 9s-9 -1.8 -9 -9s1.8 -9 9 -9z" /></svg>
                                <div class="text-start ms-2">
                                    <h4 class="card-title mb-1 fw-bolder text-dark">
                                        @triaje.NombresPaciente @triaje.ApellidoPaternoPaciente @triaje.ApellidoMaternoPaciente
                                    </h4>
                                    <h6 class="card-text fw-normal text-dark">
                                        Estado de solicitud: <b> @triaje.TriageEstadoNombre.ToUpper() </b>   - Fecha de creación: @triaje.FechaRegistro
                                    </h6>
                                </div>
                            </div>

                            <div class="mt-3 d-md-flex gap-3 ">
                                <a asp-controller="ReservarCita" asp-route-triajeId="@triaje.TriageOnlineId" asp-action="FormularioDeReserva" class="d-flex align-items-center btn border-1 bg-primary text-white card-hover">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M7 7H6a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2v-1" /><path d="M20.385 6.585a2.1 2.1 0 0 0-2.97-2.97L9 12v3h3zM16 5l3 3" /></g></svg>
                                    <div class="w-100 text-center">
                                        <div class="card-text fs-5 fw-normal">
                                            Revisar solicitud
                                        </div>
                                    </div>
                                </a>
                            </div>

                        </div>
                    </div>


                }
            }


        </div>
    </div>
</div>

<!-- reservas Tratamiento -->
@if (Model.ListReservaTx != null && Model.ListReservaTx.Count > 0)
{
    <div class="card">
        <div class="card-body">
            <h5 class="card-title fw-semibold text-primary">TRATAMIENTO: Reserva de citas en curso.</h5>
            <p class="card-subtitle mb-3 d-none" style="text-align:justify">
                En breve, una asesora de nuestro equipo revisará la solicitud enviada. Por favor, tenga en cuenta que el tiempo dé respuesta puede variar entre 24 y 48 horas. Le recomendamos estar atento a su correo electrónico y a las actualizaciones en esta pantalla.
            </p>
            <div class="align-items-stretch">
                @foreach (var reserva in Model.ListReservaTx)
                {
                    <div class="card bg-light-subtle text-white w-100 border-1 border-muted" data-bs-html="true" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-original-title="<i class='ti ti-brand-telegram fs-5 text-info me-3'></i><b class='text-info'>SOLICITUD ENVIADA</b><hr  class='m-1'>Recibimos su solicitud, una asesora se comunicará con usted a la brevedad">
                        <div class="card-body p-3 w-100">
                            <div class="d-flex">
                                <svg xmlns="http://www.w3.org/2000/svg" width="2.5em" height="2.5em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class=" text-dark icon icon-tabler icons-tabler-outline icon-tabler-square-rounded-letter-t"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M10 8h4"></path><path d="M12 8v8"></path><path d="M12 3c7.2 0 9 1.8 9 9s-1.8 9 -9 9s-9 -1.8 -9 -9s1.8 -9 9 -9z"></path></svg>
                                <div class="text-start ms-2">
                                    <h3 class="card-title mb-1 fw-bolder text-dark">
                                        ORIENTACIÓN TRATAMIENTO:
                                        <small class="fw-normal">@reserva.Nombres @reserva.ApellidoPaterno @reserva.ApellidoMaterno</small>
                                        @if (reserva.Tipo == 2)
                                        {
                                            <small class="fw-normal">INFORME EXT. / SIN INFORME</small>
                                        }
                                    </h3>
                                    <h6 class="fw-bolder text-primary">@reserva.OrientacionMedio</h6>
                                    <h6 class="fw-bolder text-primary">@reserva.Terapia</h6>
                                    <h6 class="card-text fw-normal text-dark">
                                        Estado de respuesta: <b> @reserva.Estado.ToUpper().Replace("|","") </b>   - Fecha de creación: @reserva.CreatedDate
                                    </h6>
                                </div>
                            </div>

                            @* <div class="mt-3 d-md-flex gap-3">
                                <a  class="d-flex align-items-center btn border-1 border-primary bg-primary text-white text-primary card-hover">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M7 7H6a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2v-1" /><path d="M20.385 6.585a2.1 2.1 0 0 0-2.97-2.97L9 12v3h3zM16 5l3 3" /></g></svg>
                                    <div class="w-100 text-center">
                                        <div class="card-text fs-5 fw-normal">
                                            Revisar solicitud
                                        </div>
                                    </div>
                                </a>
                            </div> *@

                        </div>
                    </div>
                }

            </div>
        </div>
    </div>
}


<!-- seccion Calendario -->
<div class="card" id="cardCitas" style="display:none;">
    <div class="card-body">
        <div class="mb-3">
            <h5 class="card-title fw-semibold text-primary">Citas programadas</h5>
        </div>
        <div class="row mt-3">
            <div class="col-md-3 border">
                <!-- Nav tabs -->
                <div class="nav flex-column nav-pills my-3 mb-md-0" id="v-pills-tab" role="tablist"
                     aria-orientation="vertical">
                    <a class="nav-link active" id="v-pills-home-tab" data-bs-toggle="pill" href="#v-pills-home"
                       role="tab" aria-controls="v-pills-home" aria-selected="true">
                        <i class="me-2 ti ti-calendar"></i> Ver Calendario
                    </a><br />
                    <a class="nav-link" id="v-pills-profile-tab" data-bs-toggle="pill" href="#v-pills-profile"
                       role="tab" aria-controls="v-pills-profile" aria-selected="false">
                        <i class="me-2 ti ti-list-details"></i> Ver Lista
                    </a>
                </div>
            </div>
            <div class="col-md-9">
                <div class="tab-content" id="v-pills-tabContent">
                    <div class="tab-pane fade show active" id="v-pills-home" role="tabpanel"
                         aria-labelledby="v-pills-home-tab">
                        <!-- Cronograma de citas -->
                        <div class="p-md-4 py-4 calender-sidebar app-calendar">
                            <div id="calendar"></div>
                        </div>

                    </div>
                    <div class="tab-pane fade" id="v-pills-profile" role="tabpanel"
                         aria-labelledby="v-pills-profile-tab">
                        <!-- Cronograma de citas -->
                        <div id="citasContainer"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="modalInfoCita" class="modal fade" tabindex="-1" aria-labelledby="primary-header-modalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content modal-filled" id="modalInfoCita-content">
            <div class="modal-header modal-colored-header bg-primary text-white" id="modalInfoCita-head" style=" border-radius: 15px 15px 0 0; ">
                <h4 class="modal-title text-white">
                    Modal Heading
                </h4>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="modalInfoCita-body">
                <!-- modal-informacion -->
            </div>
            <div class="modal-footer d-none">
                <button type="button" class="btn btn-primary w-100" data-bs-dismiss="modal">
                    Cerrar
                </button>
            </div>
        </div>
    </div>
    <!-- /.modal-dialog -->
</div>

<div id="modalDetallePagoTriaje" class="modal fade" tabindex="-1" aria-labelledby="primary-header-modalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content modal-filled">
            <div class="modal-body">
                <div class="row col-12 px-3"><p><b>Descripción:</b> <span id="textDescripcion"></span></p></div>
                <div class="row col-12 px-3"><p><b>Sede: </b><span id="textSede"></span></p></div>
                <div class="row col-12 px-3"><p><b>Fecha: </b><span id="textFecha"></span></p></div>
                <div class="row col-12 px-3"><p><b>Monto: </b><span id="textMonto"></span></p></div>
                <div class="row col-12 " id="textDetalle"></div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-muted w-100" data-bs-dismiss="modal">
                    Cerrar
                </button>
            </div>
        </div>
    </div>
    <!-- /.modal-dialog -->
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script src="~/assets/libs/fullcalendar/index.global.min.js" asp-append-version="true"></script>
    <script src="~/assets/libs/fullcalendar/locales/es.global.js" asp-append-version="true"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            // Función para cargar las citas próximas
            function cargarCitasProximas() {
                $.ajax({
                    url: '@Url.Action("GetCitasProximas", "Home")',
                    type: 'POST',
                    dataType: 'json',
                    success: function (response) {
                        // console.log(response.data)
                        // Aquí puedes procesar los datos recibidos
                        // y actualizar tu vista
                        actualizarVista(response.data);
                    },
                    error: function (xhr, status, error) {
                        console.error('Error al recuperar las citas:', error);
                    }
                });
            }

            // Llama a la función para cargar las citas al cargar la página
            cargarCitasProximas();

            // Función para actualizar la vista con los datos recibidos
            function actualizarVista(citas) {
                var citasContainer = $('#citasContainer'); // Asegúrate de tener un contenedor en tu vista para las citas
                citasContainer.empty(); // Limpiar cualquier contenido anterior

                if (citas && citas.length > 0) {
                    document.getElementById('cardCitas').style.display = 'block';
                    // Generar HTML
                    var icon = '<svg xmlns="http://www.w3.org/2000/svg" class="me-2" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-user"> <path stroke="none" d="M0 0h24v24H0z" fill="none" /> <path d="M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0" /> <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" /> </svg>'
                    var citaHtml = '<div class="card shadow-none mt-3 mb-0">';
                    console.log(citas);
                    $.each(citas, function (index, grupo) {
                        citaHtml += '<div class="d-flex align-items-center gap-3 py-3 border-bottom"><div><h6><b class="text-primary">' + icon + grupo.nombrePaciente + '</b> - <span class="text-warning"><b> HC ' + grupo.numeroHistoriaClinica + '</b></span></h6>' +
                            '<ul class="timeline-widget mb-0 position-relative ps-md-5">';

                        $.each(grupo.citas, function (index, cita) {
                            var tipo = '<span class="badge fw-semibold py-1 w-100 bg-success-subtle text-success">' + cita.tipo + '</span>'
                            if (cita.tipo == "PRESENCIAL") {
                                tipo = '<span class="badge fw-semibold py-1 w-100 bg-info-subtle text-info">' + cita.tipo + '</span>'
                            }
                            citaHtml += '<li class="timeline-item d-flex position-relative overflow-hidden"> ' +
                                '<div class="timeline-time text-dark flex-shrink-0 text-end"><b> Cita Nro ' + cita.numeroCita + '</b><br class="d-md-none"> - ' + cita.fechaCita + '<br>' + cita.horaCitaDesde + ' - ' + cita.horaCitaHasta + '</div> ' +
                                '<div class="timeline-badge-wrap d-flex flex-column align-items-center"> <span class="timeline-badge border-2 border border-info flex-shrink-0 my-8"></span> <span class="timeline-badge-border d-block flex-shrink-0"></span> </div> ' +
                                '<div class="timeline-desc fs-3 text-dark mt-n1 w-100"><b>' + cita.area + '</b> - ' + cita.evaluacion + ' ' + tipo + '</div> </li>';
                        });

                        citaHtml += '</ul></div></div>';
                    });

                    citaHtml += '</div>'; // Cerrar el contenedor de la tarjeta
                    citasContainer.append(citaHtml);
                    iniciarCalendario();

                } else {
                    citasContainer.append('<p>No se encontraron datos.</p>');
                }
            }


        });
        var calendarsEvents = {
            Danger: "danger",
            Success: "success",
            Primary: "primary",
            TRATAMIENTO: "warning",
            DIAGNOSTICO: "info",
        };

        function iniciarCalendario() {
            var calendarEl = document.getElementById('calendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                locale: 'es',
                events: '@Url.Action("GetCalendarEvents", "Home")',
                eventClassNames: function ({ event: calendarEvent }) {
                    const getColorValue =
                        calendarsEvents[calendarEvent._def.extendedProps.calendar];
                    return [
                        "event-fc-color fc-bg-" + getColorValue,
                    ];
                },
                eventClick: calendarEventClick,
            });
            calendar.render();
        }

        /*=====================*/
        // Calender Event Function
        /*=====================*/
        var calendarEventClick = function (info) {
            var eventObj = info.event;
            var infoCitasbody = $('#modalInfoCita-body');
            var infoCitashead = $('#modalInfoCita-head');
            var infoCitasContent = $('#modalInfoCita-content'); // Asegúrate de tener un contenedor en tu vista para las citas
            infoCitasbody.empty();
            infoCitashead.empty();
            infoCitasContent.removeClass(function (index, className) {  // Eliminar clases que comiencen con 'bg-'
                return (className.match(/\bbg-\S+/g) || []).join(' ');
            });
            var bgEvent = eventObj._def.extendedProps["calendar"].toLowerCase() === "diagnostico" ? "info" : "warning";

            infoCitashead.removeClass('bg-warning');
            infoCitashead.removeClass('bg-info');
            infoCitashead.addClass('bg-' + bgEvent); // Agregar la clase 'bg-..'

            var myModal = new bootstrap.Modal(document.getElementById("modalInfoCita"));
            var htmlHead = '<h4 class="text-white mb-2"><b>' + eventObj._def.extendedProps["area"] + '</b></h4> <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>';
            var htmlInfoCita = '' +
                '<h5 class="text-dark mb-2"><span class="fw-bolder">Atención para :</span><br>' + eventObj._def.extendedProps["hc"] + ' - ' + eventObj._def.extendedProps["nombre"] + '</h5>' +
                '<h5 class="mt-0 text-dark mb-2"><span class="fw-bolder">Evaluación :</span><br>' + eventObj._def.extendedProps["descripcion"] + ' - ' + eventObj._def.extendedProps["evaluacion"] + '</h5>' +
                '<p class="text-dark mb-2"><span class="fw-bolder">Sede :</span><br> ' + eventObj._def.extendedProps["sede"] + ' (' + eventObj._def.extendedProps["tipo"] + ')</p>' +
                '<p class="text-dark mb-0"><span class="fw-bolder">Fecha / Hora :</span><br>' + eventObj._def.extendedProps["fecha"] + '  - De  ' + eventObj._def.extendedProps["inicio"] + ' a ' + eventObj._def.extendedProps["fin"] + '</p>'

            infoCitashead.append(htmlHead);
            infoCitasbody.append(htmlInfoCita);
            myModal.show();
        };


        function ShowDetallePago(idPago) {
            $.ajax({
                url: '@Url.Action("ShowDetallePagoTriaje", "Home")', // URL de la acción en el controlador
                type: 'GET', // Método de la solicitud
                data: { id: idPago }, // Parámetro que deseas enviar
                success: function (response) {
                    // Ejemplo: Actualizar el DOM con los datos recibidos
                    $('#textDescripcion').html(response.descripcion);
                    $('#textSede').html(response.sede);
                    $('#textFecha').html(response.fechaPago);
                    $('#textDetalle').html(response.detalle);
                    $('#textMonto').html(response.monto);

                    // console.log(response)
                    $("#modalDetallePagoTriaje").modal("show")
                },
                error: function (xhr, status, error) {
                    // Manejo de errores
                    console.error('Error en la solicitud AJAX:', status, error);
                }
            });
        }

    </script>
}